{
  "openapi": "3.0.1",

  "info": {
    "version": "1.0.0",

    "title": "API Docs",
    "description": "Showing off kapu$ta api",

    "license": {
      "name": "MIT",
      "url": "https://opensource.org/licenses/MIT"
    }
  },

  "consumes": ["application/json"],

  "produces": ["application/json"],

  "servers": [
    {
      "url": "https://kapusta-app-teamproject.herokuapp.com/api"
    },
    {
      "url": "http://localhost:3000/api"
    }
  ],

  "tags": [
    {
      "name": "Auth",
      "description": "Authorization endpoints"
    },
    {
      "name": "Balance",
      "description": "Balance endpoints"
    },
    {
      "name": "Categories",
      "description": "Categories endpoint"
    },
    { "name": "Transactions", "description": "Transaction endpoints" },
    {
      "name": "Reports",
      "description": "Reports endpoint"
    }
  ],

  "paths": {
    "/auth/register": {
      "post": {
        "tags": ["Auth"],
        "summary": "User's registration",

        "parameters": [],

        "security": [
          {
            "Bearer": []
          }
        ],

        "requestBody": {
          "description": "Registration's object",
          "required": true,

          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RegistrationRequest"
              }
            }
          }
        },

        "responses": {
          "201": {
            "description": "Successful operation",

            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RegistrationResponse"
                }
              }
            }
          },

          "400": {
            "description": "Bad request (invalid request body)",

            "content": {}
          },

          "409": {
            "description": "Provided email already exists",

            "content": {}
          }
        }
      }
    },
    "/auth/login": {
      "post": {
        "summary": "User's login",
        "tags": ["Auth"],
        "security": [
          {
            "Bearer": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/LoginRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful operation",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/LoginResponse"
                }
              }
            }
          }
        }
      }
    },
    "/auth/logout": {
      "post": {
        "summary": "user's logout",
        "tags": ["Auth"],
        "security": [
          {
            "Bearer": []
          }
        ],
        "responses": {
          "204": {
            "description": "No Content"
          }
        }
      }
    },
    "/auth/verify/{verificationToken}": {
      "get": {
        "tags": ["Auth"],
        "summary": "in progress...",
        "parameters": [
          {
            "in": "path",
            "name": "verificationToken",
            "required": true,
            "schema": { "type": "string", "description": "user's token" }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful operation",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/LoginResponse"
                }
              }
            }
          }
        }
      }
    },
    "/balance": {
      "get": {
        "tags": ["Balance"],
        "summary": "Get user's balance",
        "security": [
          {
            "Bearer": []
          }
        ],
        "responses": {
          "200": {
            "description": "Successful operation",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BalanceResponse"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": ["Balance"],
        "summary": "Create user's balance",
        "security": [
          {
            "Bearer": []
          }
        ],
        "requestBody": {
          "description": "create balance",
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/BalanceRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Successful operation",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BalanceResponse"
                }
              }
            }
          }
        }
      }
    },
    "/categories": {
      "get": {
        "tags": ["Categories"],
        "summary": "get all categories",
        "security": [{ "Bearer": [] }],
        "responses": {
          "200": {
            "description": "Successful operation",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CategoriesResponse"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": ["Categories"],
        "summary": "create category",
        "security": [{ "Bearer": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CategoryRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Successful operation",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CategoryResponse"
                }
              }
            }
          }
        }
      }
    },
    "/transactions": {
      "get": {
        "tags": ["Transactions"],
        "summary": "Get transactions",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "in": "path",
            "name": "type",
            "required": true,
            "schema": {
              "type": "string",
              "example": "['debit' || 'credit' || 'all']"
            }
          },
          {
            "in": "path",
            "name": "period",
            "required": true,
            "schema": {
              "type": "string",
              "example": "2030-01-22T16:23:45.678Z"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful operation",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TransactionsResponse"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": ["Transactions"],
        "summary": "Create transaction",
        "security": [{ "Bearer": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/TransactionRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Successful operation",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TransactionResponse"
                }
              }
            }
          }
        }
      }
    },
    "/transactions/{transactionId}": {
      "delete": {
        "tags": ["Transactions"],
        "summary": "Delete transaction",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "in": "path",
            "name": "transactionId",
            "required": true,
            "schema": { "type": "string", "description": "transaction Id" }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful operation",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TransactionDeleteResponse"
                }
              }
            }
          }
        }
      }
    },
    "/reports/summary": {
      "get": {
        "summary": "Summary transactions",
        "security": [
          {
            "Bearer": []
          }
        ],
        "tags": ["Reports"],
        "parameters": [
          {
            "in": "path",
            "name": "type",
            "required": true,
            "type": "string",
            "description": "['debit' || 'credit']",
            "example": "debit"
          },
          {
            "in": "path",
            "name": "period",
            "type": "integer",
            "required": true,
            "description": "year (format: yyyy. example: 2022)",
            "example": "2022"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful operation",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SummaryResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad request"
          }
        }
      }
    },
    "/reports/detailed": {
      "get": {
        "tags": ["Reports"],
        "summary": "Get report by year and month",
        "parameters": [
          {
            "in": "path",
            "name": "year",
            "type": "integer",
            "required": true,
            "description": "year (format: yyyy. example: 2022)",
            "example": "2022"
          },
          {
            "in": "path",
            "name": "month",
            "type": "integer",
            "required": true,
            "description": "month (from 0 - january to 11-december)",
            "example": "11"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful operation",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ReportResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad request"
          }
        }
      }
    }
  },

  "components": {
    "schemas": {
      "RegistrationRequest": {
        "type": "object",

        "required": ["email", "password"],

        "properties": {
          "name": {
            "type": "string",
            "description": "User's name",
            "example": "Pedro Gonzales"
          },
          "email": {
            "type": "string",
            "description": "User's email",
            "example": "user@mail.com"
          },

          "password": {
            "type": "string",
            "description": "User's password",
            "example": "qwerty123"
          }
        }
      },
      "LoginRequest": {
        "type": "object",

        "required": ["email", "password"],

        "properties": {
          "email": {
            "type": "string",
            "description": "User's email",
            "example": "user@mail.com"
          },

          "password": {
            "type": "string",
            "description": "User's password",
            "example": "qwerty123"
          }
        }
      },
      "LoginResponse": {
        "type": "object",
        "properties": {
          "status": { "type": "string" },
          "code": { "type": "integer" },
          "data": {
            "type": "object",
            "properties": {
              "user": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "user's name",
                    "example": "Pedro Gonzales"
                  },
                  "email": {
                    "type": "string",
                    "description": "user's email",
                    "example": "user@mail.com"
                  },
                  "token": {
                    "type": "string",
                    "description": "token"
                  },
                  "avatarUrl": {
                    "type": "string",
                    "description": "user's avatar URL"
                  }
                }
              }
            }
          }
        }
      },
      "RegistrationResponse": {
        "type": "object",

        "properties": {
          "status": { "type": "string" },
          "code": { "type": "integer" },
          "data": {
            "type": "object",
            "properties": {
              "user": {
                "type": "object",
                "properties": {
                  "name": { "type": "string", "description": "user's name" },
                  "email": { "type": "email", "description": "user's email" },
                  "verifyToken": { "type": "string", "description": "token" },
                  "avatarUrl": {
                    "type": "string",
                    "description": "user's avatar URL"
                  }
                }
              }
            }
          }
        },

        "example": {
          "status": "success",
          "code": 200,
          "data": {
            "user": {
              "name": "userName",
              "email": "userName@mail.com",
              "verifyToken": "inn2nsdukybcsudy.dcsiudcsdbcsd.sdcnscbasa",
              "avatarUrl": "http://gravatar.com/1234"
            }
          }
        }
      },
      "BalanceResponse": {
        "type": "object",
        "properties": {
          "status": { "type": "string" },
          "code": { "type": "integer" },
          "result": {
            "type": "number",
            "description": "balance",
            "example": "5000.00"
          }
        },
        "example": {
          "status": "success",
          "code": 200,
          "result": "5000.00"
        }
      },
      "BalanceRequest": {
        "type": "object",
        "properties": {
          "value": {
            "type": "number",
            "description": "initialize balance",
            "required": true,
            "example": "5000.00"
          }
        }
      },
      "CategoriesResponse": {
        "type": "object",
        "properties": {
          "status": { "type": "string", "description": "status of response" },
          "code": { "type": "number", "description": "" },
          "data": {
            "type": "object",
            "description": "",
            "properties": {
              "result": {
                "type": "object",
                "properties": {
                  "ids": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  },
                  "entities": {
                    "type": "object",
                    "properties": {
                      "_id": {
                        "type": "object",
                        "properties": {
                          "_id": { "type": "string" },
                          "type": {
                            "type": "string",
                            "example": "['debit' || 'credit']"
                          },
                          "name": { "type": "string" },
                          "iconUrl": { "type": "string" }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      "CategoryResponse": {
        "type": "object",
        "properties": {
          "status": { "type": "string", "description": "status of response" },
          "code": { "type": "number", "description": "" },
          "data": {
            "type": "object",
            "description": "",
            "properties": {
              "result": {
                "type": "object",
                "properties": {
                  "_id": { "type": "string" },
                  "type": {
                    "type": "string",
                    "example": "['debit' || 'credit']"
                  },
                  "name": { "type": "string" },
                  "iconUrl": { "type": "string" }
                }
              }
            }
          }
        }
      },
      "CategoryRequest": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "required": true,
            "example": "['debit' || 'credit']"
          },
          "name": { "type": "string", "required": true }
        }
      },
      "TransactionRequest": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "required": true,
            "example": "['debit' || 'credit']"
          },
          "period": {
            "type": "string",
            "example": "дата в форматі ISO 8601 (метод toISOString())"
          },
          "description": {
            "type": "string",
            "example": "назва 2-20 символів кирил, англ букви, цифри та пробіли.  починається з букви"
          },
          "category": { "type": "string", "example": "id категорії" },
          "amount": { "type": "number", "example": "число" }
        }
      },
      "TransactionResponse": {
        "type": "object",
        "properties": {
          "status": { "type": "string", "description": "status of response" },
          "code": { "type": "number", "description": "" },
          "data": {
            "type": "object",
            "description": "",
            "properties": {
              "result": {
                "type": "object",
                "properties": {
                  "transaction": {
                    "type": "object",
                    "properties": {
                      "_id": { "type": "string" },
                      "type": {
                        "type": "string",
                        "example": "['debit' || 'credit']"
                      },
                      "completedAt": {
                        "type": "string",
                        "example": "2030-01-22T16:23:45.678Z"
                      },
                      "description": { "type": "string" },
                      "category": {
                        "type": "string",
                        "example": "id категорії"
                      },
                      "amount": { "type": "number", "example": "5250.00" }
                    }
                  },
                  "balance": {
                    "type": "number",
                    "example": "оновлений баланс"
                  }
                }
              }
            }
          }
        }
      },
      "TransactionDeleteResponse": {
        "type": "object",
        "properties": {
          "status": { "type": "string", "description": "status of response" },
          "code": { "type": "number", "description": "" },
          "data": {
            "type": "object",
            "description": "",
            "properties": {
              "result": {
                "type": "object",
                "properties": {
                  "balance": { "type": "number", "example": "оновлений баланс" }
                }
              }
            }
          }
        }
      },
      "TransactionsResponse": {
        "type": "object",
        "properties": {
          "status": { "type": "string", "description": "status of response" },
          "code": { "type": "number", "description": "" },
          "data": {
            "type": "object",
            "description": "",
            "properties": {
              "result": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "_id": { "type": "string" },
                    "type": {
                      "type": "string",
                      "example": "['debit' || 'credit']"
                    },
                    "completedAt": {
                      "type": "string",
                      "example": "2022-04-30T21:00:00.000Z"
                    },
                    "description": {
                      "type": "string",
                      "example": "bought a lot of beer on sale"
                    },
                    "category": {
                      "type": "string",
                      "example": "id категорії"
                    },
                    "amount": { "type": "number", "example": "число" }
                  }
                }
              }
            }
          }
        }
      },
      "SummaryResponse": {
        "type": "object",
        "properties": {
          "status": { "type": "string", "description": "status of response" },
          "code": { "type": "number", "description": "" },
          "data": {
            "type": "object",
            "description": "",
            "properties": {
              "result": {
                "type": "object",
                "properties": {
                  "ids": {
                    "type": "array",
                    "items": {
                      "type": "integer",
                      "description": "month index (0 - january, 1 - february, etc)",
                      "example": 11
                    }
                  },
                  "entities": {
                    "type": "object",
                    "properties": {
                      "11": {
                        "type": "object",
                        "description": "month index (0 - january, 1 - february, etc)",
                        "properties": {
                          "id": {
                            "type": "integer",
                            "description": "month index (0 - january, 1 - february, etc)",
                            "example": 11
                          },
                          "name": { "type": "string", "example": "december" },
                          "amount": { "type": "number", "example": "3100.00" }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      "ReportResponse": {
        "type": "object",
        "properties": {
          "status": { "type": "string", "description": "status of response" },
          "code": { "type": "number", "description": "" },
          "data": {
            "type": "object",
            "properties": {
              "result": {
                "type": "object",
                "properties": {
                  "totalIncome": {
                    "type": "number",
                    "description": "",
                    "example": "16000.00"
                  },
                  "totalCosts": {
                    "type": "number",
                    "description": "",
                    "example": "3100"
                  },
                  "caregories": {
                    "type": "object",
                    "description": "",
                    "properties": {
                      "_id": { "type": "string" },
                      "type": {
                        "type": "string",
                        "example": "[cost || income]"
                      },
                      "total": { "type": "number", "example": "1500" },
                      "name": { "type": "string", "example": "Всё для дома" },
                      "iconUrl": {
                        "type": "string",
                        "example": "http://localhost:8080/icons/61e1796fb8d7c55e164168fc.svg"
                      },
                      "subcategories": {
                        "type": "object",
                        "properties": {
                          "id": { "type": "string", "example": "599ug2GrIDX" },
                          "name": {
                            "type": "string",
                            "example": "Бытовая химия"
                          },
                          "total": { "type": "number", "example": "1500" }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },

    "securitySchemes": {
      "Bearer": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    }
  }
}
